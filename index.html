<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CLO3D Pro AI — Kianoush</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- قفل ورود با PIN -->
  <div id="lockOverlay" class="lock">
    <div class="lock-card">
      <h2>ورود با PIN</h2>
      <p class="muted small">برای اولین‌بار با این PIN قفل می‌شود. بعداً از تنظیمات تغییر بده.</p>
      <input id="pinInput" class="input big" inputmode="numeric" maxlength="6" placeholder="مثلاً 4068">
      <div class="row">
        <button id="unlockBtn" class="btn">ورود</button>
        <button id="resetVaultBtn" class="ghost" title="پاک کردن همهٔ داده‌ها">پاک‌سازی کامل</button>
      </div>
      <div id="lockMsg" class="small muted"></div>
    </div>
  </div>

  <div class="app" id="app" hidden>
    <header class="topbar">
      <div class="brand">
        <h1>CLO3D Pro AI</h1>
        <div class="sub">تم خودکار · رمزگذاری محلی · آفلاین · هوش کمکی</div>
      </div>
      <div class="actions">
        <button id="quickPom" class="btn mini" title="شروع پومودورو">⏳</button>
        <button id="quickAdd" class="btn mini" title="افزودن کار/جلسه">＋</button>
        <button id="themeToggle" class="ghost">🌗 تم</button>
        <button id="exportCsvBtn" class="btn">CSV</button>
        <button id="backupBtn" class="ghost">پشتیبان JSON (رمز)</button>
        <button id="importBtn" class="ghost">وارد کردن</button>
        <input type="file" id="importFile" accept=".json" style="display:none" />
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <div class="card">
          <label>امروز: <strong id="todayLabel"></strong></label>
          <label>انتخاب تاریخ</label>
          <input type="date" id="selectedDate" class="input" />
          <div class="small muted">تاریخ را می‌توانی دستی تغییر دهی</div>
        </div>

        <div class="card">
          <strong>سه هدف اصلی</strong>
          <div id="mainTasks" class="tasks"></div>
          <div class="addRow">
            <input id="customTitle" class="input" placeholder="عنوان کار دلخواه" />
            <input id="customStart" type="time" class="input" />
            <button id="addCustomBtn" class="btn">افزودن</button>
          </div>
        </div>

        <div class="card">
          <strong>قالب‌های روز</strong>
          <div class="row wrap">
            <select id="templateSelect" class="input">
              <option value="learn">روز یادگیری (جلسه جدید)</option>
              <option value="produce">روز تولید (بدون ویدئو)</option>
              <option value="review">روز مرور/رفع اشکال</option>
            </select>
            <input id="templateSession" class="input smallInput" placeholder="شماره جلسه">
            <button id="applyTemplate" class="btn">پر کردن</button>
          </div>
        </div>

        <div class="card">
          <strong>پومودورو</strong>
          <div class="pomRow">
            <label>کار</label><input id="pomWork" type="number" value="25" min="5" class="input smallInput">
            <label>استراحت</label><input id="pomShort" type="number" value="5" min="1" class="input smallInput">
            <label>بلند</label><input id="pomLong" type="number" value="15" min="5" class="input smallInput">
          </div>
          <div class="pomControls">
            <div id="pomTimer" class="timerCircle">25:00</div>
            <div class="pomButtons">
              <button id="pomStart" class="btn">شروع</button>
              <button id="pomPause" class="ghost">وقفه</button>
              <button id="pomReset" class="ghost">ریست</button>
            </div>
            <div class="small muted">حالت: <span id="pomState">کار</span> · چرخه‌ها: <span id="pomCycles">0</span> · قفل تمرکز: <span id="focusState">خاموش</span></div>
          </div>
        </div>

        <div class="card">
          <strong>یادداشت روزانه</strong>
          <textarea id="dayNote" rows="6" class="input" placeholder="ایده‌ها، نکات آموزشی..."></textarea>
          <div class="row">
            <button id="saveNoteBtn" class="btn">ذخیره</button>
            <button id="searchNotesBtn" class="ghost">جستجو</button>
          </div>
        </div>

        <div class="card">
          <strong>تنظیمات امنیت</strong>
          <div class="row">
            <input id="newPin" class="input" placeholder="PIN جدید (۴ تا ۶ رقم)">
            <button id="changePinBtn" class="ghost">تغییر PIN</button>
          </div>
          <div class="small muted">AES-GCM · PBKDF2=300k · قفل ۵ تلاش + تاخیر افزایشی</div>
        </div>
      </aside>

      <section class="content">
        <div class="card wide">
          <div class="flexBetween">
            <h2 id="dayTitle">برنامه روز</h2>
            <div class="small muted">آفلاین + اعلان‌ها + رمزگذاری</div>
          </div>

          <div id="taskList" class="taskList"></div>

          <div class="controlsRow">
            <input id="manualTime" type="time" class="input smallInput" />
            <input id="manualText" class="input" placeholder="لاگ دستی (مثلاً: 21:10 — دیدن جلسه 3)" />
            <button id="addManualLog" class="btn">ثبت لاگ</button>
          </div>
        </div>

        <div class="card">
          <h3>آمار ۷ روز</h3>
          <canvas id="progressChart" height="120"></canvas>
          <div class="small muted" id="statsSummary"></div>
        </div>

        <div class="card">
          <h3>استریک و هدف هفتگی</h3>
          <div class="row">استریک: <strong id="streakDays">0</strong> روز 🔥</div>
          <div class="row">هدف هفته: <span id="weeklyGoalText">0/5</span></div>
          <div class="row">
            <button id="recalcStats" class="ghost">به‌روزرسانی</button>
            <button id="enableNoti" class="btn">فعال‌سازی اعلان</button>
          </div>
        </div>

        <div class="card">
          <h3>مرور فاصله‌مند (Ebbinghaus)</h3>
          <div id="reviewList" class="small"></div>
        </div>

        <div class="card">
          <h3>پیغام علمی امروز</h3>
          <div id="scienceMsg" class="science"></div>
        </div>

        <div class="card">
          <h3>هوش رشد (Agent)</h3>
          <div id="agentBox" class="small">در حال بارگذاری…</div>
        </div>

        <div class="card">
          <h3>تاریخچه روز</h3>
          <ul id="history" class="historyList"></ul>
        </div>
      </section>
    </main>

    <footer class="footer">ساخته‌شده برای کیانوش — نسخه Pro AI</footer>
  </div>

  <script src="app.js"></script>
</body>
</html>
